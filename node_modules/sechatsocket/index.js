var connection = require('./connection.js');

function init (site, locker) {
	var keys = {};
	var control = {
		socket: undefined,
		connect: function () {
			return connection.createSocketConnection(site, keys, locker);
		},
	};
	return connection.login(site, keys, locker)
		.then(function () {
			return connection.getChatCredentials(site, keys, locker);
		})
		.then(control.connect)
		.then(function (socket) {
			control.socket = socket;
			control.keys = keys;
			console.log(
				'Seems like things went alright. ' +
				'The object return holds your socket in the `.socket` property. ' +
				'If the chat socket hangs up, call `.connect` on this object instead of relogging in!'
			);
			return control;
		});
}

module.exports = init;
